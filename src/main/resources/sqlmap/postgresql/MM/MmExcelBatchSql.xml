<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="mmExcelBatch">
    
    <select id="MMExcelBATCH.selectSourceTable" parameterClass="java.util.Map" resultClass="java.util.LinkedHashMap" remapResults="true">
        SELECT
        <dynamic> 
            <iterate property="COLUMN_LIST" conjunction=",">
              <isEqual property="COLUMN_LIST[].COLUMN_TYPE" compareValue="4">
                $COLUMN_LIST[].COLUMN_NAME$ AS $COLUMN_LIST[].COLUMN_TRANS$
              </isEqual>
              <isNotEqual property="COLUMN_LIST[].COLUMN_TYPE" compareValue="4">
                $COLUMN_LIST[].COLUMN_NAME$ AS $COLUMN_LIST[].COLUMN_TRANS$
              </isNotEqual>
            </iterate>
        </dynamic>
              ,'N' AS ERROR_YN <!-- excel방식은 화면에서 validation하므로 에러가 없음으로 표기함 -->
          FROM $SOURCE_TABLE$
         WHERE COMPANY_CD = #COMPANY_CD#
    </select>
    
    <delete id="MMExcelBATCH.deleteSourceTable" parameterClass="java.util.Map">
        DELETE FROM $SOURCE_TABLE$
         WHERE COMPANY_CD = #COMPANY_CD#
    </delete>
    
    <update id="MMExcelBATCH.insertSourceTable" parameterClass="java.util.Map">
        INSERT INTO $SOURCE_TABLE$
        <dynamic> 
            <iterate open="(" close=", CREATE_DATE)" property="COLUMN_LIST" conjunction=",">
                $COLUMN_LIST[].COLUMN_NAME$
            </iterate>
        </dynamic>
        SELECT
        <dynamic>
            <iterate close=", NOW()" property="COLUMN_LIST" conjunction=",">
                $COLUMN_LIST[].COLUMN_TRANS_TYPE$
            </iterate>
        </dynamic>
          FROM (
                SELECT COMPANY_CD
                      ,IF_CD
                      ,USER_ID
                      ,ROW_NO
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE01' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE01
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE02' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE02
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE03' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE03
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE04' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE04
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE05' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE05
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE06' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE06
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE07' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE07
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE08' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE08
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE09' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE09
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE10' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE10
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE11' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE11
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE12' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE12
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE13' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE13
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE14' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE14
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE15' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE15
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE16' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE16
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE17' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE17
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE18' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE18
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE19' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE19
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE20' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE20
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE21' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE21
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE22' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE22
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE23' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE23
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE24' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE24
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE25' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE25
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE26' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE26
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE27' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE27
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE28' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE28
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE29' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE29
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE30' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE30
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE31' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE31
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE32' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE32
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE33' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE33
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE34' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE34
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE35' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE35
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE36' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE36
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE37' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE37
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE38' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE38
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE39' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE39
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE40' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE40
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE41' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE41
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE42' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE42
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE43' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE43
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE44' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE44
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE45' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE45
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE46' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE46
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE47' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE47
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE48' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE48
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE49' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE49
                      ,MAX(CASE WHEN COLUMN_ID = 'ATTRIBUTE50' THEN (CASE WHEN COLUMN_VALUE = '' THEN NULL ELSE  COLUMN_VALUE END) END) AS ATTRIBUTE50
                      ,TO_CHAR(MAX(CREATE_DATE),'YYYYMMDD') AS CREATE_DATE
                  FROM EXCEL_DATA_CHECK
                 WHERE COMPANY_CD = #COMPANY_CD#
                   AND IF_CD = #IF_CD#
                   AND USER_ID = #USER_ID#
                 GROUP BY COMPANY_CD
                         ,IF_CD
                         ,USER_ID
                         ,ROW_NO
                ) E
    </update>
    
    <delete id="MMExcelBATCH.deleteTargetTable" parameterClass="java.util.Map">
        DELETE FROM $TARGET_TABLE$
         WHERE COMPANY_CD = #COMPANY_CD#
    </delete>
    
    <select id="MMExcelBATCH.selectInterfaceItemMst" parameterClass="java.util.Map" resultClass="java.util.LinkedHashMap">
    	SELECT SOURCE_TABLE, TARGET_TABLE, HISTORY_TABLE
    	  FROM INTERFACE_ITEM_MST
    	 WHERE COMPANY_CD = #COMPANY_CD#
           AND IF_CD = #IF_CD#
    </select>
    
    <select id="MMExcelBATCH.selectInterfaceItemDtl" parameterClass="java.util.Map" resultClass="java.util.LinkedHashMap">
        SELECT FROM_COL_ID AS COLUMN_TRANS, case when data_type in ('number', 'float', 'int') then FROM_COL_ID||'::numeric' else FROM_COL_ID END AS COLUMN_TRANS_TYPE <!-- 소스컬럼 -->
              ,TO_COL_ID AS COLUMN_NAME <!-- 대상컬럼 -->
          FROM INTERFACE_ITEM_DTL
         WHERE COMPANY_CD = #COMPANY_CD#
           AND IF_CD = #IF_CD#
         ORDER BY COL_SEQ
    </select>
    
</sqlMap>